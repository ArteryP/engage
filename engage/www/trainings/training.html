{% extends "templates/custom_web.html" %}

{% macro render_breadcrumbs() %}
<nav aria-label="breadcrumb">
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="/">Trainings</a></li>
        <li class="breadcrumb-item active" aria-current="page">{{ t.title }}</li>
    </ol>
</nav>
{% endmacro %}

{% macro Sidebar() %}
<div class="sidebar">
    <div class="card">
        <div class="card-body">
            <h5 class="card-title">Training Notes</h5>
            <a href="{{ t.live_notes_url }}" class="btn btn-secondary" target="_blank">Open Training Notes</a>
        </div>
    </div>

    <div class="card">
        <div class="card-body">
            <h5 class="card-title">Jupyter Lab</h5>

            <p>Your credentials to access Jupyter Lab:</p>
            <p>
                Username: {{participant.jh_username}}<br>
                Password: {{participant.jh_password}}
            </p>

            <a href="{{ t.jupyterhub_url }}" class="btn btn-secondary" target="_blank">Launch Jupyter Lab</a>
        </div>
    </div>
    {% for s in t.sidebar_sections %}
    <div class="card">
        <div class="card-body">
            <h5 class="card-title">{{ s.title }}</h5>
            {{ frappe.utils.md_to_html(s.body) }}
        </div>
    </div>
    {% endfor %}
</div>
{% endmacro %}

{% macro ProblemSet(pset) %}
{% set doc = frappe.get_doc("Problem Set", pset.problem_set) %}
<div class="card">
    <div class="card-body">
        <h5 class="card-title">{{ pset.title }}</h5>

        <div>{{doc.problems | length}} problems</div>
    </div>

    <ul class="list-group list-group-flush">
        {% for p in doc.problems %}
        <li class="list-group-item"><a
                href="/trainings/{{t.name}}/problems/{{pset.slug}}/{{p.problem}}">{{p.problem_title}}</a>
            {% if p.problem in submissions %} - submitted
            {% endif %}
        </li>
        {% endfor %}
    </ul>
</div>
{% endmacro %}

{% macro ProblemSets() %}
<div class="h3">Problem Sets</div>
{% if t.problem_sets %}
<div class="row">
    {% for pset in t.problem_sets %}
    <div class="col-md-4">
        {{ ProblemSet(pset) }}
    </div>
    {% endfor %}
</div>
{% else %}
<em>No problem sets have been assigned to you so far. Please check again later.</em>
{% endif %}
{% endmacro %}

{% macro TrainingBody() %}
<div class="row">
    <div class="col-md-9">
        <div class="training-body">
            {{ ProblemSets() }}
        </div>
    </div>
    <div class="col-md-3">
        {{ Sidebar() }}
    </div>
</div>
{% endmacro %}

{% block page_content %}
<div class="training-page">
    {{ render_breadcrumbs() }}

    <div class="training-header">
        <div class="h2">{{t.title}}</div>
        <div class="training-dates">{{frappe.utils.format_date(t.begin_date, "MMM dd")}} - {{
            frappe.utils.format_date(t.end_date, "MMM dd") }}, {{t.end_date.year}}</div>
        <div>{{client.title}}</div>
    </div>
    {% if participant %}
    {{ TrainingBody() }}
    {% else %}
    <div class="alert alert-danger">You are not a participant of this training.</div>
    {% endif %}
</div>
{% endblock %}
